@namespace GestorTeocratico.Components.Pages.Administration.Manage.Role
@using Microsoft.AspNetCore.Identity
@using GestorTeocratico.Features.Roles
@using Microsoft.AspNetCore.Components
@using Microsoft.AspNetCore.Components.Web
@using Radzen
@using Radzen.Blazor
@inject DialogService DialogService
@inject IRoleService RoleService

<PageTitle>Agregar Rol</PageTitle>

<RadzenColumn SizeMD=12>
    <RadzenAlert Shade="Shade.Lighter" Variant="Variant.Flat" Size="AlertSize.Small" AlertStyle="AlertStyle.Danger"
                 Visible="@_errorVisible">No se puede guardar el rol
    </RadzenAlert>
    <RadzenTemplateForm TItem="RoleViewModel" Data="@(_role)" Visible="@(_role != null)"
                        Submit="@HandleValidSubmit">
        <RadzenRow style="margin-bottom: 1rem">
            <RadzenColumn SizeMD="3">
                <RadzenLabel Text="Nombre" Component="Name" style="width: 100%"/>
            </RadzenColumn>
            <RadzenColumn SizeMD="9">
                <RadzenTextBox style="display: block; width: 100%" @bind-Value="@(_role!.Name)" Name="Name"/>
                <RadzenRequiredValidator Component="Name" Text="El nombre es obligatorio"/>
            </RadzenColumn>
        </RadzenRow>
        <RadzenStack Orientation="Orientation.Horizontal" AlignItems="AlignItems.Center"
                     JustifyContent="JustifyContent.End" Gap="0.5rem">
            <RadzenButton ButtonStyle="ButtonStyle.Primary" ButtonType="ButtonType.Submit" Icon="save" Text="Guardar"
                          Variant="Variant.Outlined"/>
            <RadzenButton ButtonStyle="ButtonStyle.Light" Text="Cancelar" Variant="Variant.Outlined"
                          Click="@CancelButtonClick"/>
        </RadzenStack>
    </RadzenTemplateForm>
</RadzenColumn>

@code {
    private RoleViewModel _role = new() { Name = string.Empty };
    private bool _errorVisible;

    private async Task HandleValidSubmit()
    {
        try
        {
            await RoleService.CreateAsync(_role.Name);
            DialogService.Close(true);
        }
        catch
        {
            _errorVisible = true;
        }
    }

    private void CancelButtonClick(MouseEventArgs args)
    {
        DialogService.Close(null);
    }

    public class RoleViewModel
    {
        public string Id { get; set; } = string.Empty;
        public string Name { get; set; } = string.Empty;
    }
}
